#!bin/sh

DIRECTORY=/scripts/dns_adblock
RESOLUTION=192.168.1.250
RESOLUTION_V6=::

LOGMSG=DNS_UPDATE_PROC_IS_DONE

#hostnamelist
sudo rm -rf $DIRECTORY/hostnames.txt
sudo wget -O $DIRECTORY/hostnames_raw.txt https://raw.githubusercontent.com/notracking/hosts-blocklists/master/hostnames.txt

sudo cat $DIRECTORY/hostnames_raw.txt $DIRECTORY/static_blockhosts.txt >> $DIRECTORY/hostnames.txt



#domainslist
sudo rm -rf $DIRECTORY/domains.txt
sudo wget https://raw.githubusercontent.com/notracking/hosts-blocklists/master/domains.txt -P $DIRECTORY


#pgl.yoyo.org
sudo wget -O $DIRECTORY/pgl.txt https://pgl.yoyo.org/as/serverlist.php?hostformat=dnsmasq&showintro=1&mimetype=plaintext  
sudo cat $DIRECTORY/pgl.txt |grep -E '^address'|sed -e "s/127.0.0.1/$RESOLUTION/g" >> $DIRECTORY/domains.txt

sudo wget -O $DIRECTORY/malware.txt https://www.malwaredomainlist.com/hostslist/hosts.txt
sudo cat $DIRECTORY/malware.txt |grep -E '^address'|sed -e  "s/127.0.0.1/$RESOLUTION/g" >> $DIRECTORY/domains.txt


#Warui_Internet
sudo rm -rf $DIRECTORY/warui_host.txt
sudo wget -O $DIRECTORY/warui_host.txt https://warui.intaa.net/adhosts/hosts.txt
sudo cat  $DIRECTORY/warui_host.txt >> $DIRECTORY/hostnames.txt



sudo sed -i  "s/127\.0\.0\.1 /$RESOLUTION /g" $DIRECTORY/hostnames.txt 
sudo sed -i  "s/0\.0\.0\.0 /$RESOLUTION /g" $DIRECTORY/hostnames.txt 
sudo sed -i  "s/:: /$RESOLUTION_V6 /g" $DIRECTORY/hostnames.txt 

sudo cat $DIRECTORY/static_blockdomain.txt >> $DIRECTORY/domains.txt
sudo cat $DIRECTORY/static_blockhosts.txt >> $DIRECTORY/hostnames.txt

sudo sed -i  "s/127\.0\.0\.1/$RESOLUTION/g" $DIRECTORY/domains.txt 
sudo sed -i  "s/0\.0\.0\.0/$RESOLUTION/g" $DIRECTORY/domains.txt 

#dnsmasq_restart
sudo systemctl stop dnsmasq
sleep 3s
sudo systemctl start dnsmasq

#sudo echo nameserver 9.9.9.9 >> /run/dnsmasq/resolv.conf

{ echo [`uname -n`]; date; echo $LOGMSG; }|paste - - -  >> /scripts/log/dns_scripts.log
